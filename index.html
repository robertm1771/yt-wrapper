<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3-Panel URL Loader</title>
    <style>
        :root {
            --side-width: 35%;
            --top-height: 60%;
            --gutter-size: 10px;
            --handle-color: #2a2a2a;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }

        #controls {
            padding: 10px;
            background: #111;
            display: flex;
            gap: 12px;
            flex-wrap: nowrap;
            box-sizing: border-box;
            align-items: center;
            overflow-x: auto;
        }

        #controls input {
            width: 280px;
            padding: 5px;
            background: #000;
            border: 1px solid #444;
            color: #fff;
            font-size: 12px;
        }

        #controls > div {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        #controls button {
            padding: 6px 12px;
            border: 1px solid #444;
            background: #222;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
        }

        #controls button:hover {
            background: #333;
        }

        .version {
            margin-left: auto;
            font-size: 12px;
            color: #0ff;
            background: #002b36;
            border: 1px solid #044a63;
            border-radius: 12px;
            padding: 4px 10px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .version::before {
            content: "●";
            color: #4cf3ff;
            font-size: 10px;
        }

        #status {
            font-size: 12px;
            color: #8f8;
            min-height: 16px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1 1 200px;
        }

        #layout {
            height: calc(100% - 60px);
            display: grid;
            position: relative;
            grid-template-columns: calc(100% - var(--side-width)) var(--side-width);
            grid-template-rows: var(--top-height) calc(100% - var(--top-height));
            grid-template-areas:
                "main side"
                "bottom bottom";
            gap: var(--gutter-size);
            padding: 8px;
            box-sizing: border-box;
        }

        .main-pane {
            grid-area: main;
        }

        .side-pane {
            grid-area: side;
        }

        .bottom-pane {
            grid-area: bottom;
            width: 100%;
            aspect-ratio: 16 / 9;
            height: auto;
            max-height: 100%;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #000;
        }

        .resize-handle {
            position: absolute;
            background: var(--handle-color);
            z-index: 5;
            opacity: 0.7;
            transition: background 0.2s ease, opacity 0.2s ease;
            touch-action: none;
        }

        .resize-handle:hover,
        .resize-handle:active {
            background: #3a3a3a;
            opacity: 1;
        }

        .resize-handle.vertical {
            top: 8px;
            bottom: auto;
            height: calc(var(--top-height) + (var(--gutter-size) / 2));
            width: var(--gutter-size);
            left: calc(100% - var(--side-width));
            cursor: col-resize;
        }

        .resize-handle.horizontal {
            left: 8px;
            right: 8px;
            height: var(--gutter-size);
            top: var(--top-height);
            cursor: row-resize;
        }
    </style>
</head>
<body>

    <div id="controls">
        <div>
            <input id="leftUrl" type="text" placeholder="Left frame URL">
            <input id="url1" type="text" placeholder="Right-side URL">
            <input id="url2" type="text" placeholder="Bottom URL">
            <button onclick="loadOrRefreshAll()">Load/Refresh All</button>
        </div>

        <div id="status" aria-live="polite"></div>

        <div class="version" aria-label="Application version" id="appVersion">v0.3.0</div>
    </div>

    <div id="layout">
        <!-- NOTE: referrerpolicy added here -->
        <iframe
            class="main-pane"
            id="leftFrame"
            allowfullscreen
            referrerpolicy="strict-origin-when-cross-origin">
        </iframe>

        <iframe class="side-pane" id="frame1"></iframe>
        <iframe class="bottom-pane" id="frame2"></iframe>

        <div class="resize-handle vertical" id="verticalHandle" title="Drag to resize side panel"></div>
        <div class="resize-handle horizontal" id="horizontalHandle" title="Drag to resize bottom panel"></div>
    </div>

<script>
const APP_VERSION = "v0.3.0";
const FRAME_LABELS = {
    leftFrame: "Left frame",
    frame1: "Right frame",
    frame2: "Bottom frame",
};
const PLACEHOLDER_STYLE = "body{margin:0;padding:0;font-family:Arial,Helvetica,sans-serif;background:#06090f;color:#7bd6ff;display:flex;align-items:center;justify-content:center;height:100%;}main{display:flex;flex-direction:column;gap:8px;align-items:center;max-width:420px;text-align:center;padding:16px;}h1{font-size:18px;font-weight:700;margin:0;color:#c6e8ff;}p{margin:0;font-size:14px;color:#9acffb;line-height:1.4;}";
const LEFT_PANEL_KEY = "yt-wrapper:left-panel";
const RIGHT_PANELS_KEY = "yt-wrapper:right-panels";
const LAYOUT_KEY = "yt-wrapper:layout";
const DEFAULT_LAYOUT = {
    sideWidth: 35,
    topHeight: 60,
};
let layoutState = { ...DEFAULT_LAYOUT };

function placeholderMarkup(label = "Frame") {
    return `<html><head><style>${PLACEHOLDER_STYLE}</style></head><body><main><h1>${label} is empty</h1><p>Enter a URL above and click the load button to display it here.</p></main></body></html>`;
}

function setFrameSrc(frameId, url) {
    const frame = document.getElementById(frameId);
    const target = url || "";
    const current = frame.getAttribute("src") || "";

    if (!target) {
        frame.removeAttribute("src");
        frame.srcdoc = placeholderMarkup(FRAME_LABELS[frameId] || "Frame");
        return;
    }

    frame.removeAttribute("srcdoc");

    // Force reload even if the same URL is entered again.
    if (current === target) {
        frame.src = "about:blank";
        requestAnimationFrame(() => frame.src = target);
    } else {
        frame.src = target;
    }
}

function renderVersion() {
    const versionEl = document.getElementById("appVersion");
    if (versionEl) {
        versionEl.textContent = `Version ${APP_VERSION}`;
        versionEl.setAttribute("data-version", APP_VERSION);
    }

    document.title = `3-Panel URL Loader (${APP_VERSION})`;
}

function persistLeftPanel(url) {
    try {
        localStorage.setItem(LEFT_PANEL_KEY, JSON.stringify({ url }));
    } catch (e) {
        console.warn("Unable to persist left panel URL", e);
    }
}

function restoreLeftPanel() {
    try {
        const raw = localStorage.getItem(LEFT_PANEL_KEY);
        if (!raw) return;

        const { url = "" } = JSON.parse(raw);

        document.getElementById("leftUrl").value = url;

        if (url) {
            setFrameSrc("leftFrame", url);
            showStatus("Restored left frame.");
        }
        if (!url) {
            setFrameSrc("leftFrame", "");
        }
    } catch (e) {
        console.warn("Unable to restore left panel URL", e);
    }
}

function persistRightPanels(url1, url2) {
    const payload = { url1, url2 };
    try {
        localStorage.setItem(RIGHT_PANELS_KEY, JSON.stringify(payload));
    } catch (e) {
        console.warn("Unable to persist right panel URLs", e);
    }
}

function restoreRightPanels() {
    try {
        const raw = localStorage.getItem(RIGHT_PANELS_KEY);
        if (!raw) return;

        const { url1 = "", url2 = "" } = JSON.parse(raw);

        document.getElementById("url1").value = url1;
        document.getElementById("url2").value = url2;

        setFrameSrc("frame1", url1);
        setFrameSrc("frame2", url2);

        if (url1 || url2) {
            showStatus("Restored right-side panels.");
        }
    } catch (e) {
        console.warn("Unable to restore right panel URLs", e);
    }
}

function clamp(value, min, max) {
    return Math.min(max, Math.max(min, value));
}

function applyLayout({ sideWidth = layoutState.sideWidth, topHeight = layoutState.topHeight } = {}) {
    const newSideWidth = clamp(sideWidth, 15, 85);
    const newTopHeight = clamp(topHeight, 25, 85);

    layoutState = {
        sideWidth: newSideWidth,
        topHeight: newTopHeight,
    };

    document.documentElement.style.setProperty("--side-width", `${newSideWidth}%`);
    document.documentElement.style.setProperty("--top-height", `${newTopHeight}%`);
}

function persistLayout() {
    try {
        localStorage.setItem(LAYOUT_KEY, JSON.stringify(layoutState));
    } catch (e) {
        console.warn("Unable to persist layout", e);
    }
}

function restoreLayoutSizing() {
    try {
        const raw = localStorage.getItem(LAYOUT_KEY);
        if (!raw) {
            applyLayout(DEFAULT_LAYOUT);
            return;
        }

        const saved = JSON.parse(raw);
        applyLayout({
            sideWidth: saved.sideWidth ?? DEFAULT_LAYOUT.sideWidth,
            topHeight: saved.topHeight ?? DEFAULT_LAYOUT.topHeight,
        });
    } catch (e) {
        console.warn("Unable to restore layout", e);
        applyLayout(DEFAULT_LAYOUT);
    }
}

function startResize(type, event) {
    event.preventDefault();
    const layout = document.getElementById("layout");
    const rect = layout.getBoundingClientRect();

    const startX = event.clientX;
    const startY = event.clientY;
    const startSideWidth = layoutState.sideWidth;
    const startTopHeight = layoutState.topHeight;
    const previousUserSelect = document.body.style.userSelect;
    document.body.style.userSelect = "none";

    function onMove(e) {
        if (type === "vertical") {
            const deltaX = e.clientX - startX;
            const sideWidth = clamp(startSideWidth - ((deltaX / rect.width) * 100), 15, 85);
            applyLayout({ sideWidth });
        } else if (type === "horizontal") {
            const deltaY = e.clientY - startY;
            const topHeight = clamp(startTopHeight + ((deltaY / rect.height) * 100), 25, 85);
            applyLayout({ topHeight });
        }
    }

    function onUp(e) {
        if (e.target.releasePointerCapture) {
            e.target.releasePointerCapture(event.pointerId);
        }
        document.body.style.userSelect = previousUserSelect;
        persistLayout();
        document.removeEventListener("pointermove", onMove);
        document.removeEventListener("pointerup", onUp);
    }

    if (event.target.setPointerCapture) {
        event.target.setPointerCapture(event.pointerId);
    }

    document.addEventListener("pointermove", onMove);
    document.addEventListener("pointerup", onUp);
}

function loadOrRefreshAll() {
    const leftUrl = document.getElementById("leftUrl").value.trim();
    const rightUrl = document.getElementById("url1").value.trim();
    const bottomUrl = document.getElementById("url2").value.trim();

    const messages = [];

    setFrameSrc("leftFrame", leftUrl);
    persistLeftPanel(leftUrl);
    messages.push(leftUrl ? "Left frame loaded." : "Left frame cleared.");

    if (!rightUrl && !bottomUrl) {
        setFrameSrc("frame1", "");
        setFrameSrc("frame2", "");
        persistRightPanels("", "");
        messages.push("No right URLs provided.");
    } else {
        setFrameSrc("frame1", rightUrl);
        setFrameSrc("frame2", bottomUrl);
        persistRightPanels(rightUrl, bottomUrl);

        const loadedFrames = [];
        if (rightUrl) loadedFrames.push("Right frame");
        if (bottomUrl) loadedFrames.push("Bottom frame");
        const label = loadedFrames.length === 2 ? "Right frames" : loadedFrames[0];
        messages.push(`${label} refreshed.`);
    }

    showStatus(messages.join(" · "));
}

function renderInitialPlaceholders() {
    setFrameSrc("leftFrame", "");
    setFrameSrc("frame1", "");
    setFrameSrc("frame2", "");
}

// Enter key auto-load for all URLs
document.getElementById("leftUrl").addEventListener("keydown", function(e){
    if (e.key === "Enter") loadOrRefreshAll();
});

document.getElementById("url1").addEventListener("keydown", function(e){
    if (e.key === "Enter") loadOrRefreshAll();
});

document.getElementById("url2").addEventListener("keydown", function(e){
    if (e.key === "Enter") loadOrRefreshAll();
});

document.getElementById("verticalHandle").addEventListener("pointerdown", function(e){
    startResize("vertical", e);
});

document.getElementById("horizontalHandle").addEventListener("pointerdown", function(e){
    startResize("horizontal", e);
});

function showStatus(message, isError = false) {
    const el = document.getElementById("status");
    el.textContent = message;
    el.style.color = isError ? "#f55" : "#8f8";
}

renderVersion();
restoreLayoutSizing();
renderInitialPlaceholders();
restoreLeftPanel();
restoreRightPanels();
showStatus(`Ready · ${APP_VERSION}`);
</script>

</body>
</html>
