<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3-Panel YouTube + URL Loader</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }

        #controls {
            padding: 10px;
            background: #111;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            box-sizing: border-box;
            align-items: center;
        }

        #controls input {
            width: 280px;
            padding: 5px;
            background: #000;
            border: 1px solid #444;
            color: #fff;
            font-size: 12px;
        }

        #controls > div {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        #controls button {
            padding: 6px 12px;
            border: 1px solid #444;
            background: #222;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
        }

        #controls button:hover {
            background: #333;
        }

        .version {
            margin-left: auto;
            font-size: 12px;
            color: #aaa;
        }

        #status {
            font-size: 12px;
            color: #8f8;
            min-height: 16px;
        }

        #layout {
            height: calc(100% - 60px);
            display: grid;
            grid-template-columns: 2fr 1fr; /* left big, right smaller */
        }

        .right-pane {
            display: grid;
            grid-template-rows: 1fr 1fr;
            height: 100%;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #000;
        }
    </style>
</head>
<body>

    <div id="controls">
        <div>
            <input id="ytInput" type="text" placeholder="Paste YouTube link here (watch, live, or youtu.be)">
            <button onclick="loadYouTube()">Load YouTube</button>
            <button onclick="refreshYouTube()">Refresh YouTube</button>
        </div>

        <div>
            <input id="url1" type="text" placeholder="Right top URL">
            <input id="url2" type="text" placeholder="Right bottom URL">
            <button onclick="loadOther()">Load Right Frames</button>
            <button onclick="refreshRightFrames()">Refresh Right Frames</button>
        </div>

        <div id="status" aria-live="polite"></div>

        <div class="version" aria-label="Application version">v0.1</div>
    </div>

    <div id="layout">
        <!-- NOTE: referrerpolicy added here -->
        <iframe
            id="ytFrame"
            allowfullscreen
            referrerpolicy="strict-origin-when-cross-origin">
        </iframe>

        <div class="right-pane">
            <iframe id="frame1"></iframe>
            <iframe id="frame2"></iframe>
        </div>
    </div>

<script>
function convertToEmbedded(url) {
    if (!url) return "";

    url = url.trim();

    // Already embed
    if (url.includes("youtube.com/embed/") || url.includes("youtube-nocookie.com/embed/")) {
        return url;
    }

    try {
        const u = new URL(url);

        // Standard watch URL
        if (u.hostname.includes("youtube.com") && u.pathname === "/watch") {
            const id = u.searchParams.get("v");
            if (id) return "https://www.youtube-nocookie.com/embed/" + id;
        }

        // youtu.be short link
        if (u.hostname === "youtu.be") {
            const id = u.pathname.replace("/", "");
            if (id) return "https://www.youtube-nocookie.com/embed/" + id;
        }

        // Live URL
        if (u.hostname.includes("youtube.com") && u.pathname.startsWith("/live/")) {
            const id = u.pathname.split("/")[2];
            if (id) return "https://www.youtube-nocookie.com/embed/" + id;
        }
    } catch (e) {
        console.error("Invalid URL:", e);
    }

    // Fallback
    return url;
}

function setFrameSrc(frameId, url) {
    const frame = document.getElementById(frameId);
    const target = url || "about:blank";
    const current = frame.getAttribute("src") || "";

    // Force reload even if the same URL is entered again.
    if (current === target) {
        frame.src = "about:blank";
        requestAnimationFrame(() => frame.src = target);
    } else {
        frame.src = target;
    }
}

const RIGHT_PANELS_KEY = "yt-wrapper:right-panels";

function persistRightPanels(url1, url2) {
    const payload = { url1, url2 };
    try {
        localStorage.setItem(RIGHT_PANELS_KEY, JSON.stringify(payload));
    } catch (e) {
        console.warn("Unable to persist right panel URLs", e);
    }
}

function restoreRightPanels() {
    try {
        const raw = localStorage.getItem(RIGHT_PANELS_KEY);
        if (!raw) return;

        const { url1 = "", url2 = "" } = JSON.parse(raw);

        document.getElementById("url1").value = url1;
        document.getElementById("url2").value = url2;

        if (url1) setFrameSrc("frame1", url1);
        if (url2) setFrameSrc("frame2", url2);

        if (url1 || url2) {
            showStatus("Restored right-side frames.");
        }
    } catch (e) {
        console.warn("Unable to restore right panel URLs", e);
    }
}

function loadYouTube() {
    const raw = document.getElementById("ytInput").value;
    const embed = convertToEmbedded(raw);

    if (!embed) {
        return showStatus("Please enter a YouTube link first.", true);
    }

    setFrameSrc("ytFrame", embed);
    showStatus("YouTube video loaded.");
}

function loadOther() {
    const url1 = document.getElementById("url1").value.trim();
    const url2 = document.getElementById("url2").value.trim();

    setFrameSrc("frame1", url1);
    setFrameSrc("frame2", url2);

    persistRightPanels(url1, url2);

    if (!url1 && !url2) {
        showStatus("Right-side frames cleared.");
    } else {
        showStatus("Right-side frames loaded.");
    }
}

function refreshYouTube() {
    const ytFrame = document.getElementById("ytFrame");
    const current = ytFrame.getAttribute("src");
    const input = document.getElementById("ytInput").value.trim();

    if (current) {
        setFrameSrc("ytFrame", current);
        showStatus("YouTube frame refreshed.");
        return;
    }

    const embed = convertToEmbedded(input);
    if (embed) {
        setFrameSrc("ytFrame", embed);
        showStatus("YouTube frame loaded and refreshed.");
    } else {
        showStatus("Nothing to refresh for YouTube.", true);
    }
}

function refreshRightFrames() {
    const url1 = document.getElementById("frame1").getAttribute("src") || document.getElementById("url1").value.trim();
    const url2 = document.getElementById("frame2").getAttribute("src") || document.getElementById("url2").value.trim();

    if (!url1 && !url2) {
        showStatus("Nothing to refresh on right side.", true);
        return;
    }

    if (url1) setFrameSrc("frame1", url1);
    if (url2) setFrameSrc("frame2", url2);

    showStatus("Right-side frames refreshed.");
}

// Enter key auto-load for YouTube
document.getElementById("ytInput").addEventListener("keydown", function(e){
    if (e.key === "Enter") loadYouTube();
});

// Enter key auto-load for the right-side URLs
document.getElementById("url1").addEventListener("keydown", function(e){
    if (e.key === "Enter") loadOther();
});

document.getElementById("url2").addEventListener("keydown", function(e){
    if (e.key === "Enter") loadOther();
});

function showStatus(message, isError = false) {
    const el = document.getElementById("status");
    el.textContent = message;
    el.style.color = isError ? "#f55" : "#8f8";
}

restoreRightPanels();
</script>

</body>
</html>
